@{
	var activePage = ViewData["ActivePage"]?.ToString() ?? "Income";
	var isIncomeActive = activePage.Equals("Income", StringComparison.OrdinalIgnoreCase);
	var isExpenseActive = activePage.Equals("Expense", StringComparison.OrdinalIgnoreCase);
	var totalIncomeFormatted = ViewData["TotalIncomeFormatted"]?.ToString() ?? "0 đ";
	var totalExpenseFormatted = ViewData["TotalExpenseFormatted"]?.ToString() ?? "0 đ";
	var remainingBalanceFormatted = ViewData["RemainingBalanceFormatted"]?.ToString() ?? "0 đ";
}


@*---------------------------------------------------------- Header ----------------------------------------------------------*@
<nav class="navbar navbar-expand-lg blur border-radius-lg top-0 z-index-3 shadow-sm mb-3 py-2 position-sticky" style="top: 0; background-color: rgba(255, 255, 255, 0.95);">
	<div class="container-fluid px-2">
		<h6 class="mb-1 d-block d-lg-none fw-bolder text-dark" style="font-size: 1.2rem;">
			QUẢN LÝ THU CHI
		</h6>
		<div class="d-flex flex-wrap justify-content-between align-items-center w-100">
			
			@* Begin: Nút bấm Thu/Chi *@
			<div class="d-flex flex-column order-1">
				@* ** Tiêu đề chỉ hiển thị trên Mobile (< lg) ** *@
				
				<ul class="navbar-nav d-flex flex-column flex-lg-row">
					<li class="nav-item me-2 mb-2 mb-lg-0">
						<button class="btn px-3 py-1 d-flex align-items-center justify-content-center border btn-outline-success" style="min-width: 120px; height: 100%;"
								id="btn-income">
							Khoản Thu
						</button>
					</li>
					<li class="nav-item">
						<button class="btn px-3 py-1 d-flex align-items-center justify-content-center border btn-outline-danger" style="min-width: 120px; height: 100%;"
								id="btn-expense">
							Khoản Chi
						</button>
					</li>
				</ul>
			</div>
			@* End: Nút bấm Thu/Chi *@

			@* Begin: Title *@
			<div class="mx-auto text-center order-lg-2 d-none d-lg-block">
				<a class="navbar-brand font-weight-bolder text-dark m-0 p-0" style="font-size: 1.1rem;" asp-controller="IncomeExpense" asp-action="Index">
					QUẢN LÝ THU CHI
				</a>
			</div>
			@* End: Title *@

			@* Begin: Tổng chi tiêu còn lại *@
			<div class="order-2 order-lg-3 mt-2 mt-lg-0">
				<ul class="navbar-nav d-flex flex-column align-items-end flex-lg-row align-items-lg-center">
					<li class="nav-item mb-1 mb-lg-0 me-lg-3">
						<span class="nav-link d-flex align-items-baseline p-0">
							<i class="fas fa-wallet text-success me-1" style="font-size: 0.8em;"></i>
							<span class="text-success small me-1">Thu:</span>
							<span class="text-success fw-bold" id="total-income">@totalIncomeFormatted</span>
						</span>
					</li>
					<li class="nav-item mb-1 mb-lg-0 me-lg-3">
						<span class="nav-link d-flex align-items-baseline p-0">
							<i class="fas fa-shopping-cart text-danger me-1" style="font-size: 0.8em;"></i>
							<span class="text-danger small me-1">Chi:</span>
							<span class="text-danger fw-bold" id="total-expense">@totalExpenseFormatted</span>
						</span>
					</li>
					<li class="nav-item">
						@* d-none d-lg-inline dùng để ẩn chữ thu chi còn*@
						<span class="nav-link d-flex align-items-center p-0">
							<i class="fas fa-piggy-bank text-warning me-1" style="font-size: 0.8em;"></i>
							<span class="text-warning small me-1">Còn:</span>
							<span class="text-warning fw-bold" id="remaining-balance">@remainingBalanceFormatted</span>
						</span>
					</li>
				</ul>
			</div>
			@* End: Tổng chi tiêu còn lại *@
		</div>
	</div>
</nav>

@*---------------------------------------------------------- Body ----------------------------------------------------------*@


<div class="row">
	@* Begin: Nhập dữ liệu *@
	<div class="col-lg-7 col-md-12 mt-md-4 mt-3">

		<div id="form-container"></div>

	</div>
	@* End: Nhập dữ liệu *@

	@* Begin: Hiển thị danh sách chọn *@
	<div class="col-lg-5 col-md-12 mt-md-4 mt-3">
		<div id="IncomeExpenseHistory"></div>
	</div>
	@* End: Hiển thị danh sách chọn *@

</div>


<!-- Script của bạn -->
<script>
	$(document).ready(function () {

		var formType = '@ViewBag.FormType';
		var rangeType = '@ViewBag.RangeType';

		// Begin: sự kiện header ------------------------

		// Gắn sự kiện click
		$("#btn-income").click(function () {
			loadForm("income");
			setActiveButton("income");
		});

		$("#btn-expense").click(function () {
			loadForm("expense");
			setActiveButton("expense");
		});

		// Khi mới vào trang, gọi updateSummary với range mặc định
		updateSummary($("#select-range").val());

		// /end: sự kiện header

		// Begin: Sự kiện box left ------------------------

		// Load form và set lại nút active ban đầu
		loadForm(formType);
		setActiveButton(formType);


		$("#btn-expense").click();
		// End: Sự kiện box left

		// Begin: Sự kiện box Right ------------------------
		loadFormHistory(rangeType);


		// End: Sự kiện box Right

		// Load form và set lại nút active ban đầu

	});

		function loadForm(type) {
		var url = "IncomeExpense/Create";
		var postData = { type: type };

		$.ajax({
			url: url,
			type: "POST",
			data: postData,
			success: function (data) {
				$("#form-container").html(data);
				loadFormCategoryEI(type === "income" ? 1 : 2); // Gọi load danh mục theo type
			},
			error: function () {
				alert("Lỗi tải form!");
			}
		});
	}


	function setActiveButton(type) {
		$("#btn-income, #btn-expense").removeClass("active");
		if (type === "income") {
			$("#btn-income").addClass("active");
		} else if (type === "expense") {
			$("#btn-expense").addClass("active");
		}
	}

		function updateSummary(range) {
		$.ajax({
			url: "IncomeExpense/GetSummary",
			type: "GET",
			data: { range: range },
			success: function (data) {
				$("#total-income").text(data.totalIncomeFormatted);
				$("#total-expense").text(data.totalExpenseFormatted);
				$("#remaining-balance").text(data.remainingBalanceFormatted);
			}
		});
	}



	function loadFormHistory(range) {
		console.log(range)
		$.ajax({
			url: "IncomeExpense/History",
			type: "GET",
			data: { range: range },
			success: function (data) {
				$("#IncomeExpenseHistory").html(data);
			},
			error: function () {
				alert("Lỗi tải form!");
			}
		});
	}


</script>


<style>
	/* Responsive adjustments */
	@@media (max-width: 991.98px) {
		/* Bỏ max-width */
		.order-1 h6 {
			font-size: 0.8rem;
		}

		.order-2, .order-1 {
			max-width: none;
		}
		/* Đảm bảo không còn max-width */
		.order-1 {
			margin-right: auto;
		}
		/* Đẩy khối phải ra xa */
		.navbar .nav-link span[id^='total-'],
		.navbar .nav-link span[id='remaining-balance'] {
			font-size: 0.85rem; /* Size chữ số tiền trên mobile */
		}
	}

	@@media (max-width: 380px) {
		.order-1 h6 {
			font-size: 0.7rem;
		}

		.navbar .nav-link span[id^='total-'],
		.navbar .nav-link span[id='remaining-balance'] {
			font-size: 0.75rem; /* Nhỏ hơn nữa */
		}

		.navbar .btn {
			font-size: 0.8rem;
			min-width: 100px !important; /* Giảm min-width trên màn hình nhỏ */
		}
	}

</style>